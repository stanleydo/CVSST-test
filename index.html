<!DOCTYPE HTML>
<html>
<head>
    <title>Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />'
    <style>
			body { margin: 0; }
			canvas { display: block; }
	</style>

    <!--  Cesium  -->
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.73/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.73/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

    <!--  Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1 id="tite">Title</h1>
    <form><input id='newtitle' type='text'>New Title</form>
    <button id='butt' type="button" >CLICK ME</button>

    <form><input id='roomid' type='text'></form>
    <button id='roomid_btn' type='button'>Join Room</button>

    <div id='chatroom'></div>
    <form><input id='msg' type='text'></form>
    <button id='send_btn' type='button'>Send</button>

    <div id="cesiumContainer" style="width: 100%; height:100%"></div>

    <script>

        // Cesium
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhN2NmMjJkOS0wMDQ5LTRmOGMtOGM5My1iODljMGZmYTg4OWUiLCJpZCI6MzUyMDMsImlhdCI6MTYwMTQ5NjQ1MX0.33fp2rPMyMGHFUNU-ESjvSomknVSBrV5eKEbTkSZFL4';
        const glob = new Cesium.Globe(Cesium.Ellipsoid.MOON);
        glob.showGroundAtmosphere = false;
        const viewer = new Cesium.Viewer("cesiumContainer", {
            skyAtmosphere: false,
            globe: glob,
            baseLayerPicker: false,
            imageryProvider: new Cesium.WebMapTileServiceImageryProvider({
                url: 'https://trek.nasa.gov/tiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0/{Style}/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}.png',
                layer: 'LRO_WAC_Mosaic_Global_303ppd_v02',
                style: 'default',
                tileMatrixSetID: 'default028mm',
                format: 'image/jpeg',
                tilingScheme: new Cesium.GeographicTilingScheme(),
                credit: new Cesium.Credit('nasa jpl trek')
            }),
        });

        const scene = viewer.scene;

        // Create a client-side socket
        // The socket defaults to the server's URL for the WS connection
        const socket = io();

        // When the socket receives a 'connect' command from the server, it does the function.
        socket.on('connect', function(){
            alert('Connected!')
        });

        //
        socket.on('changeTitle', function(data){
            let toptext = document.getElementById('tite');
            toptext.innerHTML = data;
        });

        butt = document.getElementById('butt');
        let newtext = document.getElementById('newtitle');

        butt.onclick = function() {
            socket.emit('changeTitle', newtext.value);
        }

        let roomid_btn = document.getElementById('roomid_btn');
        roomid_btn.onclick = function() {
            let roomid = document.getElementById('roomid').value;
            socket.emit('joinRoom', roomid);
        }

        socket.on('alert', function(data) {
            alert(data);
        })

        socket.on('disconnect', function(){});

        // Cesium Stuff
        var entity = viewer.entities.add({
            label: {
                show: false,
                showBackground: true,
                font: "14px monospace",
                horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                verticalOrigin: Cesium.VerticalOrigin.TOP,
                pixelOffset: new Cesium.Cartesian2(15, 0),
            },
        });

        handler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
        handler.setInputAction(function (movement) {
            var cartesian = viewer.camera.pickEllipsoid(
                movement.endPosition,
                scene.globe.ellipsoid
            );
            if (cartesian) {
                var cartographic = Cesium.Cartographic.fromCartesian(cartesian);
                var longitudeString = Cesium.Math.toDegrees(
                    cartographic.longitude
                ).toFixed(2);
                var latitudeString = Cesium.Math.toDegrees(
                    cartographic.latitude
                ).toFixed(2);

                entity.position = cartesian;
                entity.label.show = true;
                entity.label.text =
                    "Lon: " +
                    ("   " + longitudeString).slice(-7) +
                    "\u00B0" +
                    "\nLat: " +
                    ("   " + latitudeString).slice(-7) +
                    "\u00B0";
            } else {
                entity.label.show = false;
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

    </script>
</body>
</html>